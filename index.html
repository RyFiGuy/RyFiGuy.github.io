<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LB{CTF}</title>
  <style>
    :root{
      --bg: #0b0d10;
      --card: #11151b;
      --muted: #9aa4b2;
      --text: #e6edf3;
      --accent: #6ea8fe;
      --ring: rgba(110,168,254,.35);
      --ok: #36d399;
      --warn: #fbbf24;
      --hard: #ef4444;
      --shadow: 0 8px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --card:#ffffff; --text:#0f172a; --muted:#5b6472; --accent:#3b82f6; --ring:rgba(59,130,246,.25); --shadow: 0 8px 30px rgba(0,0,0,.08); }
    }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 80% -10%, rgba(110,168,254,.10), transparent),
                  radial-gradient(1000px 500px at -10% 0%, rgba(54,211,153,.08), transparent), var(--bg);
      color:var(--text);
    }
    header{
      max-width:1100px; margin:32px auto 16px; padding:0 20px; display:flex; align-items:center; gap:16px; flex-wrap:wrap;
    }
    .brand{ display:flex; align-items:center; gap:12px; flex:1 1 auto }
    .logo{
      width:40px;
      height:40px;
      border-radius:10px;
      box-shadow:var(--shadow);
      display:block;
      object-fit:contain;
      background: linear-gradient(135deg, var(--accent), var(--ok));
    }
    h1{ margin:0; font-weight:700; letter-spacing:.2px; font-size: clamp(20px, 3vw, 28px) }
    .muted{ color:var(--muted); font-size:.95rem }
    .controls{ display:flex; gap:10px; flex-wrap:wrap }
    .input, .select{
      appearance:none; border:1px solid transparent; background:var(--card); color:var(--text);
      padding:10px 12px; border-radius:12px; box-shadow:var(--shadow);
      outline:none; min-width: 180px;
    }
    .input:focus, .select:focus{ border-color: var(--accent); box-shadow: 0 0 0 6px var(--ring), var(--shadow) }
    .select{ min-width: 140px }
    .score-display{
      background: var(--card); padding:10px 16px; border-radius:12px; box-shadow:var(--shadow);
      display:flex; align-items:center; gap:8px; font-weight:600;
    }
    .score-num{ color: var(--ok); font-size:1.1rem }

    main{ max-width:1100px; margin:10px auto 60px; padding:0 20px }
    .grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap:16px }

    .card{
      background: var(--card); border:1px solid rgba(255,255,255,.06); border-radius: var(--radius);
      padding:16px; box-shadow: var(--shadow); position:relative; overflow:hidden; cursor:pointer; transition: transform .12s ease, border-color .12s ease;
    }
    .card:hover{ transform: translateY(-2px); border-color: var(--accent) }
    .card.solved{ border-color: var(--ok); opacity:0.7 }
    .card h3{ margin:4px 0 6px; font-size:1.05rem }
    .card .meta{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 0 2px }
    .badge{ display:inline-flex; align-items:center; gap:6px; padding:5px 8px; border-radius:10px; font-size:.78rem; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.06) }
    .diff-easy{ color:var(--ok) }
    .diff-med{ color:var(--warn) }
    .diff-hard{ color:var(--hard) }
    .date{ font-size:.78rem; color:var(--muted) }
    .points-badge{ background: var(--ok); color: #000; font-weight:600; border:none }
    .solved-badge{ background: var(--ok); color: #000; border:none }

    .empty{ text-align:center; padding:40px 12px; color:var(--muted) }

    dialog{ width:min(720px, 92vw); border:none; padding:0; border-radius: 20px; overflow:hidden; box-shadow: 0 20px 70px rgba(0,0,0,.45); background: var(--card); color:var(--text) }
    dialog::backdrop{ backdrop-filter: blur(6px) brightness(.7) }
    .modal-head{ padding:18px 20px; border-bottom:1px solid rgba(255,255,255,.06); display:flex; align-items:center; justify-content:space-between; gap:12px }
    .modal-title{ margin:0; font-size:1.15rem }
    .modal-body{ padding:18px 20px; white-space:pre-wrap; word-wrap:break-word }
    .modal-meta{ display:flex; gap:8px; flex-wrap:wrap; margin:6px 0 0 }
    .close{ border:1px solid rgba(255,255,255,.1); background:transparent; color:var(--text); padding:8px 12px; border-radius:10px; cursor:pointer }
    .close:hover{ border-color: var(--accent) }
    .btn-primary{ background: var(--accent); color:#fff; border:none; font-weight:600 }
    .btn-primary:hover{ opacity:0.9 }

    footer{ max-width:1100px; margin:28px auto 60px; padding:0 20px; color:var(--muted); font-size:.9rem; display:flex; gap:10px; flex-wrap:wrap }
    a{ color: var(--accent); text-decoration: none }
    a:hover{ text-decoration: underline }

    .admin-form{ display:flex; flex-direction:column; gap:12px }
    .admin-form label{ display:flex; flex-direction:column; gap:4px; font-size:.9rem }
    .admin-form textarea{ min-height:80px; resize:vertical; font-family:inherit }
    .challenge-list{ max-height:300px; overflow-y:auto; margin-top:12px }
    .challenge-item{ padding:10px; background:rgba(255,255,255,.03); border-radius:8px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center }
    .btn-delete{ background:var(--hard); color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:.85rem }
    .btn-delete:hover{ opacity:0.9 }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>LB{CTF}</h1>
        <div class="muted">Weekly CTF Challenges for LBCSI</div>
      </div>
    </div>
    <div class="controls">
      <div class="score-display">
        <span class="muted">Score:</span>
        <span class="score-num" id="totalScore">0</span>
      </div>
      <input id="search" class="input" placeholder="Search title or textâ€¦" />
      <select id="category" class="select">
        <option value="">All categories</option>
        <option>crypto</option>
        <option>forensics</option>
        <option>web</option>
        <option>pwn</option>
        <option>rev</option>
        <option>misc</option>
      </select>
      <select id="difficulty" class="select">
        <option value="">Any difficulty</option>
        <option value="easy">easy</option>
        <option value="medium">medium</option>
        <option value="hard">hard</option>
      </select>
    </div>
  </header>

  <main>
    <section id="grid" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>No challenges match your filters.</div>
  </main>

  <dialog id="modal">
    <div class="modal-head">
      <div>
        <h2 id="modalTitle" class="modal-title"></h2>
        <div class="modal-meta">
          <span id="modalCat" class="badge"></span>
          <span id="modalDiff" class="badge"></span>
          <span id="modalPoints" class="badge points-badge"></span>
          <span id="modalDate" class="badge date"></span>
        </div>
      </div>
      <button class="close" onclick="document.getElementById('modal').close()">Close</button>
    </div>
    <div id="modalBody" class="modal-body"></div>
    <div id="verifyWrap" class="modal-body" style="border-top:1px solid rgba(255,255,255,.06); display:none">
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
        <input id="flagInput" class="input" placeholder="Enter flag" style="flex:1 1 240px" autocomplete="off" />
        <button id="checkBtn" class="close btn-primary" type="button">Check flag</button>
        <span id="verifyMsg" class="muted"></span>
      </div>
    </div>
  </dialog>

  <dialog id="adminModal">
    <div class="modal-head">
      <h2 class="modal-title">Admin Panel</h2>
      <button class="close" type="button" onclick="document.getElementById('adminModal').close()">Close</button>
    </div>
    <div class="modal-body">
      <div id="adminLogin">
        <div class="admin-form">
          <label>
            <span class="muted">Password:</span>
            <input id="adminPass" class="input" type="password" placeholder="Enter admin password" />
          </label>
          <button id="loginBtn" class="close btn-primary" type="button">Login</button>
          <span id="loginMsg" class="muted"></span>
        </div>
      </div>
      <div id="adminPanel" style="display:none">
        <h3>Create Challenge</h3>
        <div class="admin-form">
          <label>
            <span class="muted">Title:</span>
            <input id="chalTitle" class="input" />
          </label>
          <label>
            <span class="muted">Category:</span>
            <select id="chalCategory" class="select">
              <option>crypto</option>
              <option>forensics</option>
              <option>web</option>
              <option>pwn</option>
              <option>rev</option>
              <option>misc</option>
            </select>
          </label>
          <label>
            <span class="muted">Difficulty:</span>
            <select id="chalDifficulty" class="select">
              <option>easy</option>
              <option>medium</option>
              <option>hard</option>
            </select>
          </label>
          <label>
            <span class="muted">Points:</span>
            <input id="chalPoints" class="input" type="number" min="1" value="100" />
          </label>
          <label>
            <span class="muted">Date (YYYY-MM-DD):</span>
            <input id="chalDate" class="input" placeholder="2025-10-13" />
          </label>
          <label>
            <span class="muted">Description:</span>
            <textarea id="chalBody" class="input"></textarea>
          </label>
          <label>
            <span class="muted">Link (optional):</span>
            <input id="chalLink" class="input" placeholder="https://..." />
          </label>
          <label>
            <span class="muted">Flag (for hash generation):</span>
            <input id="chalFlag" class="input" placeholder="Leave empty for no flag check" />
          </label>
          <button id="createChalBtn" class="close btn-primary" type="button">Create Challenge</button>
        </div>
        
        <h3 style="margin-top:24px">Existing Challenges</h3>
        <div id="challengeList" class="challenge-list"></div>
      </div>
    </div>
  </dialog>

  <dialog id="hashModal">
    <div class="modal-head">
      <h2 class="modal-title">Flag Hasher</h2>
      <button class="close" type="button" onclick="document.getElementById('hashModal').close()">Close</button>
    </div>
    <div class="modal-body">
      <label for="hashInput" class="muted">Enter exact flag text to hash:</label>
      <input id="hashInput" class="input" placeholder="CTF{your-flag-here}" style="width:100%; margin-top:8px" />
      <div id="hashOut" style="margin-top:12px; word-break:break-all"></div>
      <button id="copyHash" class="close" type="button" style="margin-top:10px">Copy hash</button>
    </div>
  </dialog>

  <footer>
    <button id="openAdmin" class="close" type="button">Admin Panel</button>
    <button id="openHasher" class="close" type="button">Flag Hasher</button>
    <button id="resetScore" class="close" type="button" style="background:var(--hard); color:#fff">Reset Score</button>
  </footer>

  <script>
    const ADMIN_PASSWORD = "lbcsi123";
    
    // State
    const state = {
      challenges: [],
      solved: {},
      score: 0,
      isAdmin: false
    };

    // Load/Save
    function loadState(){
      const saved = localStorage.getItem('lbctf');
      if(saved){
        try{
          const data = JSON.parse(saved);
          state.challenges = data.challenges || [];
          state.solved = data.solved || {};
          state.score = data.score || 0;
        }catch(e){}
      }
      
      // Default challenges if empty
      if(state.challenges.length === 0){
        state.challenges = [
          {
            id: "sanity-check",
            title: "Sanity Check",
            category: "misc",
            difficulty: "easy",
            date: "2025-10-09",
            points: 50,
            body: "Warmup: decode this base64 string and follow the usual flag format. Base64: bGJjdGZ7Y2hlY2t5b3VyYnJhaW59",
            hash: "019175aae9a148e2caba4329ec19318b3c49dae8b6b68436f291ccf6d9c04366"
          },
          {
            id: "wall-e",
            title:"wall-e",
            category: "web",
            difficulty: "easy",
            date: "2025-10-09",
            points: 100,
            body: "I hid a flag somewhere on this site where the web crawlers will NEVER find it... can you find it?",
            hash: "ce28a0fce260874f93caadd33ce3d9f7d1f75836cb8823e3f851014ea6d3354f"
          },
          {
            id: "rsa-1",
            title:"Really super awesome encryption",
            category:"crypto",
            difficulty: "easy",
            date: "2025-10-13",
            points: 150,
            body: "Whats an RSA??? Ciphertext: https://tinyurl.com/bddwwc7",
            hash: "c0a271b3a7f1100ebfeee321350376a8143cf6c5dc3bd073be2aa3e7ed8ecb39"
          },
          {
            id: "test",
            title:"test",
            category:"crypto",
            difficulty: "easy",
            date: "2025-10-13",
            points: 50,
            body: "test",
            hash: "9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08"
          }
        ];
      }
      updateScore();
    }

    function saveState(){
      localStorage.setItem('lbctf', JSON.stringify({
        challenges: state.challenges,
        solved: state.solved,
        score: state.score
      }));
    }

    function updateScore(){
      document.getElementById('totalScore').textContent = state.score;
    }

    // Render
    function escapeHTML(s){
      return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'}[m]));
    }

    function diffClass(d){
      if(d === 'easy') return 'badge diff-easy';
      if(d === 'medium') return 'badge diff-med';
      return 'badge diff-hard';
    }

    function render(){
      const q = document.getElementById('search').value.toLowerCase();
      const cat = document.getElementById('category').value.toLowerCase();
      const diff = document.getElementById('difficulty').value.toLowerCase();

      const filtered = state.challenges.filter(c => {
        const text = (c.title + ' ' + c.body + ' ' + c.category + ' ' + c.difficulty).toLowerCase();
        return (!q || text.includes(q)) && (!cat || c.category.toLowerCase() === cat) && (!diff || c.difficulty.toLowerCase() === diff);
      });

      const grid = document.getElementById('grid');
      const empty = document.getElementById('empty');
      
      if(filtered.length === 0){
        empty.hidden = false;
        grid.innerHTML = '';
        return;
      }
      
      empty.hidden = true;
      grid.innerHTML = '';

      filtered.forEach(c => {
        const solved = state.solved[c.id];
        const card = document.createElement('article');
        card.className = 'card' + (solved ? ' solved' : '');
        card.innerHTML = `
          <span class="date">${c.date || ''}</span>
          <h3>${escapeHTML(c.title)}</h3>
          <div class="meta">
            <span class="badge">${escapeHTML(c.category)}</span>
            <span class="${diffClass(c.difficulty)}">${escapeHTML(c.difficulty)}</span>
            <span class="badge points-badge">${c.points || 100} pts</span>
            ${solved ? '<span class="badge solved-badge">âœ“ Solved</span>' : ''}
          </div>
        `;
        card.onclick = () => openChallenge(c);
        grid.appendChild(card);
      });
    }

    function openChallenge(c){
      const modal = document.getElementById('modal');
      document.getElementById('modalTitle').textContent = c.title;
      document.getElementById('modalCat').textContent = c.category;
      document.getElementById('modalCat').className = 'badge';
      document.getElementById('modalDiff').textContent = c.difficulty;
      document.getElementById('modalDiff').className = diffClass(c.difficulty);
      document.getElementById('modalPoints').textContent = `${c.points || 100} pts`;
      document.getElementById('modalDate').textContent = c.date || '';
      document.getElementById('modalBody').textContent = c.body + (c.link ? `\n\nAttachment: ${c.link}` : '');

      const wrap = document.getElementById('verifyWrap');
      const input = document.getElementById('flagInput');
      const btn = document.getElementById('checkBtn');
      const msg = document.getElementById('verifyMsg');
      
      if(c.hash && !state.solved[c.id]){
        wrap.style.display = 'block';
        input.value = '';
        msg.textContent = '';
        
        btn.onclick = async () => {
          const hash = await sha256(input.value.trim());
          if(hash === c.hash){
            msg.textContent = `Correct! +${c.points || 100} points`;
            msg.style.color = 'var(--ok)';
            state.solved[c.id] = true;
            state.score += (c.points || 100);
            updateScore();
            saveState();
            setTimeout(() => { modal.close(); render(); }, 1500);
          } else {
            msg.textContent = 'Incorrect';
            msg.style.color = 'var(--hard)';
          }
        };
      } else {
        wrap.style.display = 'none';
      }

      modal.showModal();
    }

    // Admin Panel
    document.getElementById('openAdmin').onclick = () => {
      const modal = document.getElementById('adminModal');
      const login = document.getElementById('adminLogin');
      const panel = document.getElementById('adminPanel');
      
      if(state.isAdmin){
        login.style.display = 'none';
        panel.style.display = 'block';
        renderChallengeList();
      } else {
        login.style.display = 'block';
        panel.style.display = 'none';
        document.getElementById('adminPass').value = '';
        document.getElementById('loginMsg').textContent = '';
      }
      modal.showModal();
    };

    document.getElementById('loginBtn').onclick = () => {
      const pass = document.getElementById('adminPass').value;
      const msg = document.getElementById('loginMsg');
      
      if(pass === ADMIN_PASSWORD){
        state.isAdmin = true;
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        renderChallengeList();
      } else {
        msg.textContent = 'Incorrect password';
        msg.style.color = 'var(--hard)';
      }
    };

    document.getElementById('createChalBtn').onclick = async () => {
      const title = document.getElementById('chalTitle').value.trim();
      const category = document.getElementById('chalCategory').value;
      const difficulty = document.getElementById('chalDifficulty').value;
      const points = parseInt(document.getElementById('chalPoints').value) || 100;
      const date = document.getElementById('chalDate').value.trim();
      const body = document.getElementById('chalBody').value.trim();
      const link = document.getElementById('chalLink').value.trim();
      const flag = document.getElementById('chalFlag').value.trim();

      if(!title || !body){
        alert('Title and description are required');
        return;
      }

      const id = title.toLowerCase().replace(/[^a-z0-9]+/g, '-');
      const challenge = { id, title, category, difficulty, points, date, body };
      if(link) challenge.link = link;
      if(flag) challenge.hash = await sha256(flag);

      state.challenges.push(challenge);
      saveState();
      render();
      renderChallengeList();
      
      // Clear form
      document.getElementById('chalTitle').value = '';
      document.getElementById('chalBody').value = '';
      document.getElementById('chalLink').value = '';
      document.getElementById('chalFlag').value = '';
      document.getElementById('chalDate').value = '';
      
      alert('Challenge created!');
    };

    function renderChallengeList(){
      const list = document.getElementById('challengeList');
      list.innerHTML = '';
      
      state.challenges.forEach((c, i) => {
        const item = document.createElement('div');
        item.className = 'challenge-item';
        item.innerHTML = `
          <div>
            <strong>${escapeHTML(c.title)}</strong>
            <span class="muted"> - ${c.category}, ${c.difficulty}, ${c.points}pts</span>
          </div>
          <button class="btn-delete" onclick="deleteChallenge(${i})">Delete</button>
        `;
        list.appendChild(item);
      });
    }

    window.deleteChallenge = (i) => {
      if(confirm('Delete this challenge?')){
        state.challenges.splice(i, 1);
        saveState();
        render();
        renderChallengeList();
      }
    };

    // Hasher
    document.getElementById('openHasher').onclick = () => {
      document.getElementById('hashInput').value = '';
      document.getElementById('hashOut').textContent = '';
      document.getElementById('hashModal').showModal();
    };

    document.getElementById('hashInput').oninput = async (e) => {
      const val = e.target.value;
      if(!val){
        document.getElementById('hashOut').textContent = '';
        return;
      }
      const hash = await sha256(val);
      document.getElementById('hashOut').textContent = `sha256: ${hash}`;
    };

    document.getElementById('copyHash').onclick = () => {
      const txt = document.getElementById('hashOut').textContent.replace('sha256: ', '');
      if(txt) navigator.clipboard.writeText(txt);
    };

    // Reset
    document.getElementById('resetScore').onclick = () => {
      if(confirm('Reset your score and solved challenges?')){
        state.solved = {};
        state.score = 0;
        updateScore();
        saveState();
        render();
      }
    };

    // Crypto
    async function sha256(msg){
      const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(msg));
      return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    // Filter events
    document.getElementById('search').oninput = render;
    document.getElementById('category').onchange = render;
    document.getElementById('difficulty').onchange = render;

    // Init
    loadState();
    render();
  </script>
</body>
</html>
